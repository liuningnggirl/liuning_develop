<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dresser Detail</title>
<link rel="stylesheet" href="../common/css/index.css" />
<script type="text/javascript" src="../common/js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="../common/js/part/dresser_detail.js"></script>
<script type="text/javascript" src="../common/js/jquery.page.js"></script>
<script type="text/javascript" src="../common/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=321841e104684531ec3f880aeec12f17&plugin=AMap.DistrictSearch"></script>
<script src="../common/js/jquery.ui.widget.js"></script>
<script src="../common/js/jquery.iframe-transport.js"></script>
<script src="../common/js/jquery.fileupload.js"></script>
<script src="../common/js/ajaxfileupload.js" charset="utf-8"></script>
<script src="../common/js/swiper.min.js" charset="utf-8"></script>

</head>
<body>
    <div class="weight-box hzsxqq"  id="dresser_manage">
<!--  search订单编号 -->
        <div class="order-num">
            <input type="text" class="search" placeholder="化妆师昵称" />
            <input type="text" class="search_realname" placeholder="化妆师真实姓名" />
            <label for="" style="margin:0 0 0 20px;">认证情况:</label>
            <select name="" id="" class="on-select">
                <option value="">全部</option>
                <option value="0">未认证</option>
                <option value="1">已认证</option>
            </select>
            <input class="search-btn" type="button" value="搜索" style=" width:50px; height:30px; text-align:center; background:#cccccc; margin:0 0 0 10px;" />
            <input class="add-dressers-btn" type="button" value="添加化妆师" style=" width:80px; height:30px; text-align:center; background:#cccccc; margin:0 0 0 0px;" />
            <input type="button" class="cancle-btn" value="全部取消" style=" height:30px; background:#cccccc; margin:0 10px 0 0; float:right;width: 70px;" />
        </div>
<!--  订单表格信息 -->
        <table class="table-message hzsxq" cellpadding="0" cellspacing="0">
            <tr>
                <th>化妆师编号</th>
                <th>昵称</th>
                <th>真实姓名</th>
                <th>电话</th>
                <th>身份证</th>
                <th>城市</th>
                <th>地区</th>
                <th>认证</th>
                <th>加V</th>
                <th>详细资料</th>
            </tr>
        </table>
<!--  页码 -->
        <div class="tcdPageCode"></div>
    </div>
    
<!------------------------------------------------------------- 添加化妆师开始   -------------------------------------------------------------->    
<!--  添加化妆师页面 -->
    <div class="add-dresser" style="display:none;">
        <div class="order-num add-dresser" style="padding: 10px 0 10px 10px;">
            <label for="">昵　　称：</label><input type="text" class="dresser-nickname" /><br /><br />
            <label for="">真实姓名：</label><input type="text" class="dresser-name" /><br /><br />
            <label for="">手 机 号：</label><input type="text" class="dresser-tel" /><br /><br />
            <label for="">性　　别：</label><label for="">男</label><input name="sex" value="0" checked="checked" type="radio" />&nbsp;&nbsp;<label for="">女</label><input name="sex" value="1" type="radio" /><br /><br />
            <label for="">所在地区：</label>
            <select name="dresser-province" id="dresser-province">
                <option>请选择省份</option>
            </select>
            <select name="city" class="dresser-city">
                <option>请选择城市</option>
            </select><br /><br />
            <label for="">身份证号：</label><input type="tel" class="dresser-id" /><br /><br />
            <label for="">头像：</label><br /><br />
            <input type="file" id="file0-touxiang" multiple data-url="https://photos.nggirl.com.cn/uploadserver/app/image/uploads/3.0.0"/>
            <br><img src="" id="img0-touxiang" ><br /><br />

            <label for="">持身份证正面照:</label><br /><br />
            <input type="file" id="file0-qian" multiple data-url="https://photos.nggirl.com.cn/uploadserver/app/image/uploads/3.0.0" />
            <br><img src="" id="img0-qian" ><br /><br />
            <label for="">持身份证反面照:</label><br /><br />
            <input type="file" id="file0-hou" multiple data-url="https://photos.nggirl.com.cn/uploadserver/app/image/uploads/3.0.0" />
            <br><img src="" id="img0-hou" ><br /><br />
            <p>使用的化妆品</p>
            <ul class="cosmetics-class"></ul>
            <input type="button" class="dresser-btn" value="提交" />
        </div>
    </div>
<!------------------------------------------------------------- 添加化妆师结束   -------------------------------------------------------------->    

<!-----------------------------------------------------------    编辑履历开始      -------------------------------->  
    <div class="editResume-dresser">
        <label for="" class="ed-label">个人简介（100字以内）：</label><br /><br />
        <textarea class="ed-resume-content" maxlength="100" name="" id="" cols="30"></textarea><br /><br />
        <p class="ed-num"><span class="current-num">0</span>/100</p>
        <p class="ed-span">擅长领域：</p>
        <input type="text"  class="goodField one" />
        <input type="text"  class="goodField two" />
        <input type="text"  class="goodField three" /><br /><br />
        <div class="reference">
            <label for="">默认供参考：</label><span>手推波纹头、发型大拿</span>
        </div><br />
        <label for="" class="ed-label">个人写真（640*427）：</label><br /><br />
        <input type="file" name="file0" id="file-mine-img" multiple  data-url="https://photos.nggirl.com.cn/uploadserver/app/image/uploads/3.0.0" /><br><img src="" id="img-mine-img" ><br /><br />
        <label for="" class="ed-label">从业年限：</label><input type="tel" class="ed-year" />年<br /><br />
        <label for="" class="ed-label">从业经历：</label><br /><br />
        <div class="businessExperience"></div>
        <div class="ed-add">增加条目</div><br /><br />
        <label for="">合作艺人:（用中文逗号隔开）</label><br />
        <textarea class="cooperationArtists" name="" id="" cols="30"></textarea><br /><br />
        <input type="button" value="返回" class="ed-return-btn"  />
        <input type="button" value="保存" class="ed-save-btn" />
    </div>             
<!-----------------------------------------------------------    编辑履历结束      -------------------------------->  

<!------------------------------------------------------------- 管理化妆师商圈开始   -------------------------------------------------------------->  
	<div class="busi-circle">
        <div id="mapContainer"></div>
        <div id="tip">
            市：<select id='city' style="width:100px" onchange='search(this)'></select>
            区：<select id='district' style="width:100px" onchange='search(this)'></select><br />
            商圈：<div class="biz" id='biz_area'></div>
        </div>
        <label for="" style="position:absolute; top:0px;">所选商区：</label>
        <table cellpadding="0" cellspacing="0" class="selectBiz" style="height:225px; overflow:scroll;">
        	<tbody>
            	<tr>
                	<th>区域</th>
                	<th>商圈</th>
                </tr>
            </tbody>
        </table>
        <input type="button" class="bc-save" value="保存" style="padding:5px; background:#060; color:#fff;" />
        <input type="button" class="bc-return" value="返回" style="padding:5px; background:#060; color:#fff;" />
    </div>
<!------------------------------------------------------------- 管理化妆师商圈结束   -------------------------------------------------------------->  
<script type="text/javascript">
    var mapObj, district, polygons = [], citycode;
    var citySelect = document.getElementById('city');
    var districtSelect = document.getElementById('district');
    var areaSelect = document.getElementById('biz_area');
	var markerArray=[], bizAreaArray=[];
	var currentCity = '';
    mapObj = new AMap.Map('mapContainer', {
        resizeEnable: true,
        center: [116.30946, 39.937629],
        zoom: 3
    });
    //行政区划查询
    var opts = {
        subdistrict: 1,   //返回下一级行政区
        level: 'province'  //查询行政级别为 市
    };
    district = new AMap.DistrictSearch(opts);//注意：需要使用插件同步下发功能才能这样直接使用
    district.search($('.busi-circle').attr('cityname'), function(status, result) {
            getData(result);
    });
    function getData(e) {
        var dList = e.districtList;
        for (var m = 0, ml = dList.length; m < ml; m++) {
            var data = e.districtList[m].level;
            var bounds = e.districtList[m].boundaries;
            if (bounds) {
                for (var i = 0, l = bounds.length; i < l; i++) {
                    var polygon = new AMap.Polygon({
                        map: mapObj,
                        strokeWeight: 1,
                        strokeColor: '#CC66CC',
                        fillColor: '#CCF3FF',
                        fillOpacity: 0.5,
                        path: bounds[i]
                    });
                    polygons.push(polygon);
                }
                mapObj.setFitView();//地图自适应
            }
            var list = e.districtList || [],
             subList = [], level, nextLevel;
            if (list.length >= 1) {
                subList = list[0].districtList;
                level = list[0].level;				
            }
            //清空下一级别的下拉列表
            if (level === 'province') {
                nextLevel = 'city';
                citySelect.innerHTML = '';
                districtSelect.innerHTML = '';
                areaSelect.innerHTML = '';
            } else if (level === 'city') {
                nextLevel = 'district';
                districtSelect.innerHTML = '';
                areaSelect.innerHTML = '';
            } else if (level === 'district') {
                nextLevel = 'biz_area';
                areaSelect.innerHTML = '';
				bizAreaArray = subList;
				if(subList){
					//判断是否全部选中
					$('#biz_area').append('<input type="checkbox" class="select_all_item" /><label for="">全选</label>');
					for(var x = 0; x < subList.length; x ++){
						var oDiv=document.createElement("div");
						areaSelect.appendChild(oDiv);
						//判断是否已经被选中
						$('.selectBiz tbody tr:gt(0)').each(function(index, element) {
                            if($(this).children('td:eq(0)').html() == $('#district option:selected').html()){
								//获取城区对应的商圈
								var arr = $(this).children('td:eq(1)').html().split(',');
								//判断是否全部选中
								if(arr.length == subList.length){
									$('.select_all_item').attr('checked','checked');
								}else{
									$('.select_all_item').removeAttr('checked');
								}
								if( $.inArray(subList[x].name,arr) > -1){
									oDiv.innerHTML='<input type="checkbox" checked="checked" onclick= "showBizArea(this)" /><label for="">'+subList[x].name+'</label>';
									return;	
								}else{
									oDiv.innerHTML='<input type="checkbox" onclick= "showBizArea(this)" /><label for="">'+subList[x].name+'</label>';	
								}
							}
                        });
					}
				}
            }
            if (subList && level != 'district') {
				 var contentSub =new Option('--请选择--');
                for (var i = 0, l = subList.length; i < l; i++) {
                    var name = subList[i].name;
                    var levelSub = subList[i].level;
                    var cityCode = subList[i].citycode;
                    if(i==0){
                        document.querySelector('#' + levelSub).add(contentSub);
                    }
                    contentSub=new Option(name);
                    contentSub.setAttribute("value", levelSub);
                    contentSub.center = subList[i].center;
                    document.querySelector('#' + levelSub).add(contentSub);
                }
            }
        }
    }
    function search(obj) {
        //清除地图上所有覆盖物
        for (var i = 0, l = polygons.length; i < l; i++) {
            polygons[i].setMap(null);
        }
        var option = obj[obj.options.selectedIndex];
        var keyword = option.text; //关键字
        district.setLevel(option.value); //行政区级别
        district.setExtensions('all');
        //行政区查询
        district.search(keyword, function(status, result) {
            getData(result);
        });
    }
    function setCenter(obj){
        mapObj.setCenter(obj[obj.options.selectedIndex].center)
    }
	function showBizArea(selectObject){
		var bizName = selectObject.nextSibling.innerHTML;
		var localBiz = findBizAreaLocal(bizName);
		if(selectObject.checked == true){
			marker = new AMap.Marker({
            icon: "//webapi.amap.com/theme/v1.3/markers/n/mark_b.png",
            position: [localBiz.center.lng, localBiz.center.lat],
            title:localBiz.name});
			marker.setMap(mapObj);
			mapObj.setCenter(AMap.LngLat(localBiz.center.lng, localBiz.center.lat));
			markerArray.push(marker);
		}else{
			var m = findBizAreaMarker(bizName);
			if(m != undefined && m != null){
                m.setMap(null);
				mapObj.setCenter(AMap.LngLat(localBiz.center.lng, localBiz.center.lat));
            }
		}       
    }
	
	function findBizAreaLocal(bizName){
        for(localBiz in bizAreaArray){
            if(bizName == bizAreaArray[localBiz].name){
                return bizAreaArray[localBiz];
            }
        }
    }
	function findBizAreaMarker(bizName){
        for(m in markerArray){
            if(bizName == markerArray[m].getTitle()){
                return markerArray[m];
            }
        }
    }	
	
	$(function(){
	//点击管理商圈
		$('.managementDistrict-works-btm').click(function(e) {
			//获取地图的高度
			$('#mapContainer').height($(window).height());
			$.get('<%= CLI_HOST_API_URL %>/nggirl-web/web/admin/dresser/getDresserBizAreas/1.5.0',{dresserId:$('.ckxq-box .cb-left').attr('dresserid')},function(data){
				var data = $.parseJSON(data);
				if(data.code == 0){
					$('#city').children('option').remove();
					$('.busi-circle').show();
					$('.busi-circle').attr('dresserid',$('.ckxq-box .cb-left').attr('dresserid'));
					$('.busi-circle').attr('cityname',data.data.cityName);
					$('.busi-circle').attr('cityid',data.data.cityId);
					$('.ckxq').hide();
					$('.selectBiz tbody tr:gt(0)').remove();
					for(var x = 0; x < data.data.areas.length; x ++){
						$('.selectBiz tbody').append('<tr areaid = "'+data.data.areas[x].areaId+'"><td>'+data.data.areas[x].areaName+'</td><td>'+getBizAreaFn(data.data.areas[x].bizAreas)+'</td></tr>');
					}
					district.search($('.busi-circle').attr('cityname'), function(status, result) {
						getData(result);
					});
				}else{
					alert(data.data.error);	
				}
			});
		});
	});
	
	//获取对应城区的商圈个数
	function getBizAreaFn(biz){
		var str = '';
		if(biz.length != 0){
			for(var x = 0; x < biz.length; x ++){
				str += biz[x] + ',';	
			}
			str = str.substring(0,str.length -1);
		}
		return str;
	}	
</script>
</body>
</html>