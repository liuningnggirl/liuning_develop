<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no,initial-scale=1.0,maximum-scale=1.0,width=device-width">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="./css/common.css">
    <title>高管考勤</title>
    <style>
        @font-face {
            font-family: 'pingfang';
            src: url('./css/PingFang Regular.ttf');
            src: url('./css/PingFang Regular.ttf')  format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        *{    font-family: pingfang;}
        body{ background: #f1f4f8; font-family:pingfang; }
        .content_box .cb_title{background: #8AAFE1; position: relative;}
        .content_box .cb_title .cb_img{ width:60px; position: absolute; top: 15px; left: 60px;}
        .content_box .cb_title .cb_message{padding: 30px 140px;}
        .content_box .cb_title .cb_message .cm_left{ margin:0 24px 0 0;}
        .content_box .cb_title .cb_date{ padding:10px 20px; font-size:24px; background:#014195; color:#fff; display:inline-block; border-radius:50px;position: absolute; right: 72px;  top: 20px;}
        .cb_title .cb_message span{font-family: pingfang; font-size: 24px;  color: #FFFFFF;}
        .content_box .cb_content>div{ width:48.5%; background:#fff; float:left;box-shadow: 8px 8px 11px 0 rgba(118,118,118,0.19);}
        .content_box .cb_content .cc_right{ width:48.5%; background:#fff; margin-left:3%;}
        .content_box .cb_content{ padding: 3%;box-sizing: border-box;}
        .cb_content table,.cb_content table tbody{ width: 100%;border-collapse: collapse; }
        .cb_content table tbody td{text-align: center;border-top: 1px solid #E1E1E1; color:#666; font-size:15px; font-family:pingfang; width: 25%;}
        .cb_content table tbody td span{ color:#666;float: left; margin-top: 20px;}
        .cb_content table tbody td .img{ width:36px;vertical-align: inherit;margin: 11px 0;margin-right: 15px;height: 36px; border-radius: 5px; overflow: hidden;float: left; margin-left: 27%;}
        .cb_content table tbody td .status_btn{  color:#fff; font-size:15px;display:inline-block; padding:2px 20px; border-radius: 50px;  background: #51BBFF; }
        .cb_content table tr th{font-size: 18px;  color: #666666; font-weight: normal;padding:25px 0; font-family:pingfang; }
        .cb_content table tbody td .normal{ background: #51BBFF;}/*正常*/
        .cb_content table tbody td .leave{ background: #FF8181;}/*休假*/
        .cb_content table tbody td .chai{ background: #A377F6;}/*出差*/
        .cb_content table tbody td .goout{ background: #FFB10A;}/*外出*/
        .cb_content table tbody td .another{ background: #C6CACB;}/*其他*/
        .cb_content table tbody td .zanwu{ background: #647B8B;}/*其他*/
        .cb_content table tbody .arr_top_content{ position: relative;}
        .cb_content table tbody td .arr_top{ width:16.5px; position:absolute;top:0px;right:0px;}
    </style>
</head>
<body>
    <div class="content_box">
        <div class="cb_title">
            <img src="./images/icon_logo.png" alt="" class="cb_img">
            <div class="cb_message">
                <span class="cm_left">北京捷越联合信息咨询有限公司</span>
                <span class="cm_right">高管考勤</span>
            </div>
            <div class="cb_date"></div>
        </div>
        <div class="cb_content">
            <div class="cc_left">
                <table>
                    <tr>
                        <th class="name">姓名</th>
                        <th class="zhi">职位</th>
                        <th class="outday">当月出勤</th>
                        <th class="status">最新状态</th>
                    </tr>
                </table>
            </div>
            <div class="cc_right">
                <table>
                    <tr>
                        <th class="name">姓名</th>
                        <th class="zhi">职位</th>
                        <th class="outday">当月出勤</th>
                        <th class="status">最新状态</th>
                    </tr>
                </table>

            </div>
        </div>
    </div>
<script type="text/javascript" src="./js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="./js/util.js"></script>
<script>
    var localStr = window.location.href;
    localStr = localStr.substring(0,localStr.indexOf('screen'));
    $(function(){
        //1.1.2全部员工日程列表
        getAllEmployeesStatessFn();
        //每秒钟获取一次当前时间
        getSystemTime();
        //window.setInterval(getSystemTime,1000);
        window.setInterval(function(){
            getAllEmployeesStatessFn();
            getSystemTime();
        },15000);
    });
    //获取用户头像
    function isImgNull(imageurl){
        if(imageurl == null || imageurl == ''|| imageurl ==undefined ){
            imageurl = 'screen/images/Rectangle.png';
        }
        return imageurl;
    }
    //获取系统时间
    function getSystemTime() {
        var objStr = '{}';
        $.ajax({
            type: 'POST',
            contentType: "text/html; charset=UTF-8",
            url: '/schedule/selectSysDates',
            data: objStr,
            dataType: 'json',
            success: function (data) {
                $('.cb_date').html(data.responseBody);
            }
        });
    }

    //判断当前状态_文字
    function isCurrentStatusFn(state){
        if(state == 1){
            state = '正常';
        }else if(state == 2){
            state = '休假';
        }else if(state == 3){
            state = '外出';
        }else if(state == 4){
            state = '出差';
        }else if(state == 99){
            state = '其他';
        }else if(state == 100) {
            state = '暂无';
        }
        return state;
    }

    //判断当前状态_文字颜色
    function isCurrentStatusColorFn(state){
        var btn = '';
        if(state == 1){
            btn = 'normal';
        }else if(state == 2){//休假
            btn= 'leave';
        }else if(state == 3){//外出
            btn = 'goout';
        }else if(state == 4){//出差
            btn = 'chai';
        }else if(state == 99){//其他
            btn = 'another';
        }else if(state == 100) {//未打卡
            btn = 'zanwu';
        }
        return btn;
    }

    //1.1.2全部员工日程列表
    function getAllEmployeesStatessFn(){
        var obj = '{}';
        $.ajax({
            type: 'POST',
            contentType: "text/html; charset=UTF-8",
            url: '/schedule/getAllEmployeesStatess',
            data: obj,
            dataType: 'json',
            success: function (data) {
                $('.cc_left table tbody tr:gt(0)').remove();
                $('.cc_right table tbody tr:gt(0)').remove();
                var result = data.responseBody;
                if(result.length > 0 && data.retCode == '200'){
                    for( x in result){
                        if(x < 5){
                            $('.cc_left table tbody').append('<tr>\n' +
                                '                        <td>\n' +
                                '                            <img class="img" src="'+localStr+isImgNull(result[x].imageurl)+'" alt="">\n' +
                                '                            <span>'+result[x].name+'</span>\n' +
                                '                        </td>\n' +
                                '                        <td>'+result[x].job+'</td>\n' +
                                '                        <td>'+result[x].outworkday+'天</td>\n' +
                                '                        <td class="arr_top_content">\n' +
                                '                            <div class="status_btn '+isCurrentStatusColorFn(result[x].state)+'">'+isCurrentStatusFn(result[x].state)+'</div>\n' +
                                '                           <img src="./images/arr_top.png" class="arr_top" alt="">\n'+
                                '                        </td>\n' +
                                '                    </tr>');
                        }else{
                            if(x > 13){
                                $('.cc_right table tbody').append('<tr>\n' +
                                    '                        <td>\n' +
                                    '                            <img class="img" src="'+localStr+isImgNull(result[x].imageurl)+'" alt="">\n' +
                                    '                            <span>'+result[x].name+'</span>\n' +
                                    '                        </td>\n' +
                                    '                        <td>'+result[x].job+'</td>\n' +
                                    '                        <td>'+result[x].outworkday+'天</td>\n' +
                                    '                        <td class="arr_top_content">\n' +
                                    '                            <div class="status_btn '+isCurrentStatusColorFn(result[x].state)+'">'+isCurrentStatusFn(result[x].state)+'</div>\n' +
                                    '                        </td>\n' +
                                    '                    </tr>');
                            }else{
                                $('.cc_left table tbody').append('<tr>\n' +
                                    '                        <td>\n' +
                                    '                            <img class="img" src="'+localStr+isImgNull(result[x].imageurl)+'" alt="">\n' +
                                    '                            <span>'+result[x].name+'</span>\n' +
                                    '                        </td>\n' +
                                    '                        <td>'+result[x].job+'</td>\n' +
                                    '                        <td>'+result[x].outworkday+'天</td>\n' +
                                    '                        <td class="arr_top_content">\n' +
                                    '                            <div class="status_btn '+isCurrentStatusColorFn(result[x].state)+'">'+isCurrentStatusFn(result[x].state)+'</div>\n' +
                                    '                        </td>\n' +
                                    '                    </tr>');
                            }
                        }
                    }
                }else{
                    alert(data.responseBody.errorDesc);
                }
            }
        });
    }

</script>
</body>
</html>
