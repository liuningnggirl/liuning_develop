<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no,initial-scale=1.0,maximum-scale=1.0,width=device-width">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>信用卡大额借款，快至当天放款！</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="shortcut icon" href="./images/favicon.ico">
    <script type="text/javascript" src="../js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="../js/util.js"></script>
    <script type="text/javascript" src="../js/md5.js"></script>
    <script type="text/javascript" src="../js/crypto-js.js"></script>
    <script type="text/javascript" src="../js/aes.js"></script>
    <script type="text/javascript" src="../js/common.js"></script>
    <style>
        .hidden{display: none;}
        .gray_box{ width:100%;height:100%; background:rgba(0,0,0,.3); position: fixed;top:0px;left:0px; z-index: 3;}
        .gray_box .gb_arr{ width:40.2px; margin:22px 33px 0 0 ; float:right;}
        .gray_box .gb_font{ width:86.4%;margin: 100px auto; display: block;}
    </style>
    <script>
        $(function(){
            var ua = window.navigator.userAgent.toLowerCase();
            doanLoadAppFn();
            //下载app
            function doanLoadAppFn(){
                //IOS直接跳转到APP Store
                if (navigator.userAgent.match(/(iPhone|iPod|iPad);?/i)) {
                    //微信内
                    if (ua.match(/MicroMessenger/i) == 'micromessenger') {
                        console.log('ios微信内');
                        operatSystem = "ios";
                        $('.gray_box ').removeClass('hidden');
                    }else {//微信外
                        console.log('ios微信外');
                        operatSystem = "ios";
                        //getDownLoadUrl();
                        window.location.href = "iosDownLoad.html";
                    }
                }else {//安卓系统内部
                    //微信内
                    if (ua.match(/MicroMessenger/i) == 'micromessenger') {
                        console.log('android微信内');
                        operatSystem = "android";
                        $('.gray_box ').removeClass('hidden');
                    }else {//微信外
                        console.log('android微信外');
                        operatSystem = "android";
                        getDownLoadUrl();
                    }
                }
            }
//获取下载地址
            function getDownLoadUrl(){
                var bodyObj = {
                    "operatSystem": operatSystem//操作系统 android、ios（0：android， 1：ios）
                }
                var signObj = md5(JSON.stringify(bodyObj)).toUpperCase();//对body内容进行md5加密
                var randomStr = Math.random().toString(36).substr(2);
                var obj = {
                    "header": {
                        "appType": "000000",
                        "appNo": "000000",
                        "appVersion": "000000",
                        "requestId": randomStr,
                        "sign":signObj,
                        "token":"000000",
                    },
                    "body":{
                        "operatSystem": operatSystem//操作系统 android、ios（0：android， 1：ios）
                    }
                }
                var aseScret = encrypt(JSON.stringify(obj));//aes加密后
                var endObj = {
                    "data":aseScret
                }
                endObj = JSON.stringify(endObj);
                $.ajax({
                    type: 'POST',
                    contentType: "text/html; charset=UTF-8",
                    url: '/api/h5/downloadVersion/v1/',
                    headers:{AESKEY:'H5AesKey'},
                    data: endObj,
                    dataType: 'json',
                    beforeSend: function () {
                        loader.showL();
                    },
                    success: function (data) {
                        var decryptData = JSON.parse(decrypt(data.data));
                        if(decryptData.header.rspMsg == '成功'){
                            loader.hideL();
                            window.location.href = decryptData.body.downUrl;
                        }else{
                            loader.hideL();
                            showMsg($('.error-msg'), decryptData.header.rspMsg);
                        }
                    },
                    error: function (e) {
                        loader.hideL();
                    }
                });
            }
        });
    </script>
</head>
<body>
<div class="gray_box hidden">
    <img src="./images/arr.png" alt="" class="gb_arr">
    <img src="./images/font.png" alt="" class="gb_font">
</div>
</body>
</html>
